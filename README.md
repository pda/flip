Flip &mdash; flip your features
================

[Learnable](https://learnable.com) uses feature flippers, as does [Flickr](http://code.flickr.com/blog/2009/12/02/flipping-out/).

Feature flipping is useful for quickly toggling app features in production,
as well as helping make [continuous deployment](http://timothyfitz.wordpress.com/2009/02/10/continuous-deployment-at-imvu-doing-the-impossible-fifty-times-a-day/) work smoothly.

**Flip** gives us a declarative, layered way of enabling and disabling features.

There are three layers of strategies per feature:

* default
* database, to flip features site-wide for all users
* cookie, to flip features just for you

There is also a configurable system-wide default - !Rails.env.production?` works nicely.

Install
-------

Note: the alpha version number indicates Flip is currently being extracted from its host application.
**The process described here has only been tested a couple times.**
But it does have a happy ending.

**Rails 3.0 and 3.1+**

    # Gemfile
    gem "flip"
    
    # Generate the model and migration
    > rails g flip:install
    
    # Run the migration
    > rake db:migrate

    # They lived happily ever after.


Declaring Features
------------------

    # This is the model class generated by rails g flip:install
    class Feature < ActiveRecord::Base
      include Flip::Declarable

      # The recommended Flip strategy stack.
      strategy Flip::CookieStrategy
      strategy Flip::DatabaseStrategy
      strategy Flip::DefaultStrategy
      default false
    
      # A basic feature declaration.
      feature :shiny_things

      # Override the system-wide default.
      feature :world_domination, default: true

      # Enabled half the time..? Sure, we can do that.
      feature :flakey,
        default: proc { rand(2).zero? }

      # Provide a description, normally derived from the feature name.
      feature :something,
        default: true,
        description: "Ability to purchase enrollments in courses",
    
    end


Checking Features
-----------------

Feature status can be checked by any code using `on?` or using the dynamic predicate methods:

    Flip.on? :world_domination   # true
    Flip.world_domination?       # true
    
    Flip.on? :shiny_things       # false
    Flip.shiny_things?           # false

Within view and controller methods, the `FlipHelper` module provides a `feature?(key)` method:

    <div>
      <% if feature? :world_domination %>
        <%= link_to "Dominate World", world_dominations_path %>
      <% end %>
    </div>


Feature Flipping Controllers
----------------------------

The `Flip::ControllerFilters` module is mixed into the base `ApplicationController` class.  The following controller will respond with 404 Page Not Found to all but the `index` action unless the :new_stuff feature is enabled:

    class SampleController < ApplicationController
    
      require_feature :something, :except => :index
    
      def show
      end
    
      def index
      end
    
    end

Note that conditionally declared routes require a server restart to notice changes to feature flags, so they're not a good idea; database/cookie feature flipping will be ignored.


Command Center
--------------

A dashboard allows you to view and flip the features.

![Feature Flipper Dashboard](https://dl.dropbox.com/u/13833591/feature-flipper-screenshot.png "Feature Flipper Dashboard")

Here are some [basic styles](https://gist.github.com/4615688).

When integrating this into your app, you may not want the dashboard to be public.  Here's one way of implementing access control.

app/controllers/admin/features_controller.rb:

    class Admin::FeaturesController < Flip::FeaturesController
      before_filter :assert_authenticated_as_admin
    end

app/controllers/admin/feature_strategies_controller.rb:

    class Admin::FeatureStrategiesController < Flip::FeaturesController
      before_filter :assert_authenticated_as_admin
    end

routes.rb:

    namespace :admin do
      resources :features, only: [ :index ] do
        resources :feature_strategies, only: [ :update, :destroy ]
      end
    end

    mount Flip::Engine => "/admin/features"

----
Created by Paul Annesley
Copyright Â© 2011-2013 Learnable Pty Ltd, [MIT Licence](http://www.opensource.org/licenses/mit-license.php).
